
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Yet another blog">
    <title>How to count number of pilgrims in 27th Ramazan image - Yet another blog</title>
    <meta name="author" content="Khurram Amin">
    
        <meta name="keywords" content="Machine Learning,Computer Vision,LeNet,Crowd Counting,Head Detector">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="Try to count number of persons in this image. Got any guess? Post in comments. This image was taken on 03 July 2016 (On the eve of 26th Ramadan after Taraweh) at Masjid-Al-Haram, Mecca, KSA.


The pr">
<meta property="og:type" content="blog">
<meta property="og:title" content="How to count number of pilgrims in 27th Ramazan image">
<meta property="og:url" content="http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/index.html">
<meta property="og:site_name" content="Yet another blog">
<meta property="og:description" content="Try to count number of persons in this image. Got any guess? Post in comments. This image was taken on 03 July 2016 (On the eve of 26th Ramadan after Taraweh) at Masjid-Al-Haram, Mecca, KSA.


The pr">
<meta property="og:image" content="https://github.com/khurram-amin/public_on_web2/blob/master/H2cnopi27ri/3.jpg?raw=true">
<meta property="og:image" content="https://github.com/khurram-amin/public_on_web2/blob/master/H2cnopi27ri/pjimage.png?raw=true">
<meta property="og:image" content="https://github.com/khurram-amin/public_on_web2/blob/master/H2cnopi27ri/manualAnnot.png?raw=true">
<meta property="og:updated_time" content="2016-08-13T04:15:24.798Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to count number of pilgrims in 27th Ramazan image">
<meta name="twitter:description" content="Try to count number of persons in this image. Got any guess? Post in comments. This image was taken on 03 July 2016 (On the eve of 26th Ramadan after Taraweh) at Masjid-Al-Haram, Mecca, KSA.


The pr">
<meta name="twitter:image" content="https://github.com/khurram-amin/public_on_web2/blob/master/H2cnopi27ri/3.jpg?raw=true">
<meta name="twitter:creator" content="@m_khurram_amin">
    
    
        
    
    
        <meta property="og:image" content="https://www.gravatar.com/avatar/09f888ccd3dee08575bfc32e8ed8f220?s=640"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-nuvue6sithwirecbhvw3dkaobiojqvtadsnhguwi7k04xklybw5djl1smadp.min.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-81742065-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
    

<header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Yet another blog</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="https://www.gravatar.com/avatar/09f888ccd3dee08575bfc32e8ed8f220?s=90"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->


    

<nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/09f888ccd3dee08575bfc32e8ed8f220?s=110"/>
            </a>
            <span class="sidebar-profile-name">Khurram Amin</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://twitter.com/m_khurram_amin" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="mailto:khurram@mkhurram.com" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                

<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            How to count number of pilgrims in 27th Ramazan image
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" datetime="2016-08-10T15:00:00-04:00">
	
		    Aug 10, 2016
    	
    </time>
    
</div>

</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            </div><div class="figure figure--fullWidth"><img class="figure-img" src="https://github.com/khurram-amin/public_on_web2/blob/master/H2cnopi27ri/3.jpg?raw=true" alt=""><span class="caption"></span></div><div class="main-content-wrap">
<p>Try to count number of persons in this image. Got any guess? Post in comments. This image was taken on 03 July 2016 (On the eve of 26th Ramadan after Taraweh) at Masjid-Al-Haram, Mecca, KSA.</p>
<h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#how-about-detecting-counting-heads"><span class="toc-text">How about Detecting & Counting Heads?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#training-data"><span class="toc-text">Training Data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#train-classifier"><span class="toc-text">Train Classifier</span></a></li></ol></li></ol>

<p>The problem of counting number of objects in scenes, similar to the above one, is far from being solved. Even the state-of-art method can detect upto 2k-5k objects in a single image. So what about the scenes where number of objects (persons in this scene) are of order 1e4â€“1e5?</p>
<h2 id="how-about-detecting-counting-heads">How about Detecting &amp; Counting Heads?</h2>
<ol start="0" style="list-style-type: decimal">
<li>Generate training data</li>
<li>Train a classifier to detect human head</li>
<li>Generate prospective-incorporated-multi-scalar-patches from this image</li>
<li>Pass through the trained classifier</li>
<li>Visualize</li>
<li>Analyse results</li>
<li>(Optional) Generate a density map</li>
</ol>
<h3 id="training-data">Training Data</h3>
<p>As training data we used some of the images in UCF dataset and one manually annotated earlier image of Masjid-al-Haram. The sample images are shown below: <div class="figure fig-100" style="width:;"><img class="fig-img" src="https://github.com/khurram-amin/public_on_web2/blob/master/H2cnopi27ri/pjimage.png?raw=true" alt=""></div> <div class="figure fig-100" style="width:;"><img class="fig-img" src="https://github.com/khurram-amin/public_on_web2/blob/master/H2cnopi27ri/manualAnnot.png?raw=true" alt=""></div></p>
<figure class="codeblock codeblock--tabbed"><figcaption><ul class="tabs"><li class="tab active">main</li><li class="tab">createPatches</li></ul></figcaption><div class="tabs-content"><figure class="highlight plain" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">im = load image</span><br><span class="line">annotaitons = load annotations file</span><br><span class="line">// Size of patch in pixels. A square window of size patch_size*patch_Size will be generated with center annoations(i,:)</span><br><span class="line">patch_sizes = 10:10:100;</span><br><span class="line"></span><br><span class="line">for i = 1:numel(patch_sizes)</span><br><span class="line">	p = extractPatches (im, annotations, patch_sizes(i));</span><br><span class="line">	save patches in p</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plain" style="display: none;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function p = createPatches (image, annotations, patch_size )</span><br><span class="line">{</span><br><span class="line">	p = {[]};</span><br><span class="line">	for i = 1 : size ( annotations, 1 )</span><br><span class="line">		p(end+1) = { extractPatch(image, annotations(i, :), patch_size) };</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>

<p>Total number of patches generated in this process are <strong>310987 (292770 Heads, 18217 Non-heads)</strong> At the end the patches were stored as an LMDB file with 75% training set and 25% validation set. File can be downloaded from <a href="">here</a>.</p>
<h3 id="train-classifier">Train Classifier</h3>
<p>To detect human heads, varying in size from 5x5 pixels to 50x50 pixels, we choose LeNet architecture. LeNet is a simple network which has shown great effectiveness in learning hand written digits from 0-to-9 under background noise. Our assumption here is that human head is a very simple in structure so LeNet should work fine in extracting and seperating the underlying features of a human head from an image.</p>

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Computer-Vision/">Computer Vision</a> <a class="tag tag--primary tag--small t-link" href="/tags/Crowd/">Crowd</a> <a class="tag tag--primary tag--small t-link" href="/tags/Experiments/">Experiments</a> <a class="tag tag--primary tag--small t-link" href="/tags/Machine-Learning/">Machine Learning</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--disabled">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/02/Learning-to-Count-Objects-in-Images/" data-tooltip="Learning to Count Objects in Images by Lempitsky &amp; Zisserman">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Khurram Amin. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--disabled">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/08/02/Learning-to-Count-Objects-in-Images/" data-tooltip="Learning to Count Objects in Images by Lempitsky &amp; Zisserman">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="3">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://mkhurram.com/2016/08/10/How-to-count-number-of-pilgrims-in-27th-Ramazan-image/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        


    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="https://www.gravatar.com/avatar/09f888ccd3dee08575bfc32e8ed8f220?s=110"/>
        
            <h4 id="about-card-name">Khurram Amin</h4>
        
            <h5 id="about-card-bio"><p>I am a researcher and a wannabe entrepreneur</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Computer Vision &amp; Machine Learning Researcher</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Makkah, KSA
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
    <!--SCRIPTS-->
<script src="/assets/js/script-i4qo6jx6jji9fg0dftpya6ivemizsbow4fhow76d8dwpm7m1wbvi378ssumx.min.js"></script>
<!--SCRIPTS END-->

    



</html>
